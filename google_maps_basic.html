<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³æ¨è–¦ã‚¢ãƒ—ãƒª - ãƒãƒƒãƒ—è¡¨ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }
        
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .controls {
            background-color: white;
            padding: 1rem 2rem;
            border-bottom: 1px solid #ddd;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .control-group label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #555;
        }
        
        .control-group input, .control-group select {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        .map-container {
            position: relative;
            height: calc(100vh - 140px);
            width: 100%;
        }
        
        #map {
            height: 100%;
            width: 100%;
        }
        
        .status {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-size: 0.9rem;
            z-index: 1000;
        }
        
        .status.loading {
            background-color: #f39c12;
            color: white;
        }
        
        .status.success {
            background-color: #27ae60;
            color: white;
        }
        
        .status.error {
            background-color: #e74c3c;
            color: white;
        }
        
        .debug-panel {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: white;
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            max-width: 300px;
            font-size: 0.8rem;
            z-index: 1000;
            display: none;
        }
        
        .debug-panel.show {
            display: block;
        }
        
        .debug-panel h3 {
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }
        
        .debug-panel p {
            margin-bottom: 0.25rem;
            color: #555;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ½ï¸ ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³æ¨è–¦ãƒãƒƒãƒ—</h1>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <label for="location-input">å ´æ‰€ã‚’æ¤œç´¢</label>
            <input type="text" id="location-input" placeholder="ä¾‹: æ±äº¬é§…, æ¸‹è°·åŒºãªã©">
        </div>
        
        <div class="control-group">
            <label for="radius-select">æ¤œç´¢ç¯„å›²</label>
            <select id="radius-select">
                <option value="500">500m</option>
                <option value="1000" selected>1km</option>
                <option value="2000">2km</option>
                <option value="5000">5km</option>
            </select>
        </div>
        
        <button class="btn" id="search-btn">ğŸ” æ¤œç´¢</button>
        <button class="btn" id="current-location-btn">ğŸ“ ç¾åœ¨åœ°</button>
        <button class="btn" id="debug-toggle-btn">ğŸ› ãƒ‡ãƒãƒƒã‚°</button>
    </div>
    
    <div class="map-container">
        <div class="status" id="status">ãƒãƒƒãƒ—ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        
        <div id="map"></div>
        
        <div class="debug-panel" id="debug-panel">
            <h3>ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h3>
            <p><strong>åº§æ¨™:</strong> <span id="debug-coords">-</span></p>
            <p><strong>ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«:</strong> <span id="debug-zoom">-</span></p>
            <p><strong>æœ€å¾Œã®æ¤œç´¢:</strong> <span id="debug-last-search">-</span></p>
            <p><strong>APIçŠ¶æ…‹:</strong> <span id="debug-api-status">-</span></p>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let map;
        let geocoder;
        let currentPosition = null;
        let markers = [];
        
        // ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ­ã‚°é–¢æ•°
        function debugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
            
            // ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«ã®æ›´æ–°
            updateDebugPanel();
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã®æ›´æ–°
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            
            debugLog(`Status: ${message}`, type);
            
            // 3ç§’å¾Œã«éè¡¨ç¤º
            setTimeout(() => {
                if (type !== 'error') {
                    statusEl.style.display = 'none';
                }
            }, 3000);
        }
        
        // ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«ã®æ›´æ–°
        function updateDebugPanel() {
            if (!map) return;
            
            const center = map.getCenter();
            document.getElementById('debug-coords').textContent = 
                `${center.lat().toFixed(6)}, ${center.lng().toFixed(6)}`;
            document.getElementById('debug-zoom').textContent = map.getZoom();
            document.getElementById('debug-api-status').textContent = 
                typeof google !== 'undefined' ? 'OK' : 'ã‚¨ãƒ©ãƒ¼';
        }
        
        // ãƒãƒƒãƒ—ã®åˆæœŸåŒ–
        function initMap() {
            try {
                debugLog('ãƒãƒƒãƒ—åˆæœŸåŒ–é–‹å§‹');
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä½ç½®ï¼ˆæ±äº¬é§…ï¼‰
                const defaultLocation = { lat: 35.6812, lng: 139.7671 };
                
                // ãƒãƒƒãƒ—ã®ä½œæˆ
                map = new google.maps.Map(document.getElementById("map"), {
                    zoom: 15,
                    center: defaultLocation,
                    mapTypeControl: true,
                    streetViewControl: false,
                    fullscreenControl: true,
                    zoomControl: true,
                });
                
                // Geocoder ã®åˆæœŸåŒ–
                geocoder = new google.maps.Geocoder();
                
                // ãƒãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
                map.addListener('center_changed', updateDebugPanel);
                map.addListener('zoom_changed', updateDebugPanel);
                
                updateStatus('ãƒãƒƒãƒ—ã®èª­ã¿è¾¼ã¿å®Œäº†ï¼', 'success');
                debugLog('ãƒãƒƒãƒ—åˆæœŸåŒ–å®Œäº†');
                
                // ç¾åœ¨åœ°ã®å–å¾—ã‚’è©¦è¡Œ
                getCurrentLocation();
                
            } catch (error) {
                debugLog(`ãƒãƒƒãƒ—åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateStatus('ãƒãƒƒãƒ—ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        // ç¾åœ¨åœ°ã®å–å¾—
        function getCurrentLocation() {
            if (navigator.geolocation) {
                debugLog('ç¾åœ¨åœ°å–å¾—é–‹å§‹');
                updateStatus('ç¾åœ¨åœ°ã‚’å–å¾—ä¸­...', 'loading');
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        currentPosition = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        debugLog(`ç¾åœ¨åœ°å–å¾—æˆåŠŸ: ${currentPosition.lat}, ${currentPosition.lng}`);
                        updateStatus('ç¾åœ¨åœ°ã‚’å–å¾—ã—ã¾ã—ãŸ', 'success');
                        
                        // ãƒãƒƒãƒ—ã‚’ç¾åœ¨åœ°ã«ç§»å‹•
                        map.setCenter(currentPosition);
                        
                        // ç¾åœ¨åœ°ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
                        addCurrentLocationMarker(currentPosition);
                    },
                    (error) => {
                        debugLog(`ç¾åœ¨åœ°å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                        updateStatus('ç¾åœ¨åœ°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                    }
                );
            } else {
                debugLog('Geolocation API ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                updateStatus('ç¾åœ¨åœ°æ©Ÿèƒ½ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
            }
        }
        
        // ç¾åœ¨åœ°ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
        function addCurrentLocationMarker(position) {
            const marker = new google.maps.Marker({
                position: position,
                map: map,
                title: "ç¾åœ¨åœ°",
                icon: {
                    url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="8" fill="#3498db" stroke="white" stroke-width="2"/>
                            <circle cx="12" cy="12" r="3" fill="white"/>
                        </svg>
                    `),
                    scaledSize: new google.maps.Size(24, 24),
                    anchor: new google.maps.Point(12, 12)
                }
            });
            
            markers.push(marker);
            debugLog('ç¾åœ¨åœ°ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ ');
        }
        
        // ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªã‚¢
        function clearMarkers() {
            markers.forEach(marker => marker.setMap(null));
            markers = [];
            debugLog('ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªã‚¢');
        }
        
        // å ´æ‰€ã‚’æ¤œç´¢
        function searchLocation() {
            const locationInput = document.getElementById('location-input').value;
            if (!locationInput.trim()) {
                updateStatus('æ¤œç´¢ã™ã‚‹å ´æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            debugLog(`å ´æ‰€æ¤œç´¢é–‹å§‹: ${locationInput}`);
            updateStatus('å ´æ‰€ã‚’æ¤œç´¢ä¸­...', 'loading');
            
            geocoder.geocode({ address: locationInput }, (results, status) => {
                if (status === 'OK') {
                    const location = results[0].geometry.location;
                    map.setCenter(location);
                    map.setZoom(15);
                    
                    // æ¤œç´¢çµæœãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
                    const marker = new google.maps.Marker({
                        position: location,
                        map: map,
                        title: locationInput,
                        icon: {
                            url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" fill="#e74c3c" stroke="white" stroke-width="1"/>
                                    <circle cx="12" cy="9" r="2.5" fill="white"/>
                                </svg>
                            `),
                            scaledSize: new google.maps.Size(24, 24),
                            anchor: new google.maps.Point(12, 24)
                        }
                    });
                    
                    markers.push(marker);
                    
                    debugLog(`å ´æ‰€æ¤œç´¢æˆåŠŸ: ${location.lat()}, ${location.lng()}`);
                    updateStatus(`ã€Œ${locationInput}ã€ã‚’è¦‹ã¤ã‘ã¾ã—ãŸ`, 'success');
                    
                    document.getElementById('debug-last-search').textContent = locationInput;
                } else {
                    debugLog(`å ´æ‰€æ¤œç´¢ã‚¨ãƒ©ãƒ¼: ${status}`, 'error');
                    updateStatus('å ´æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'error');
                }
            });
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('DOMèª­ã¿è¾¼ã¿å®Œäº†');
            
            // æ¤œç´¢ãƒœã‚¿ãƒ³
            document.getElementById('search-btn').addEventListener('click', searchLocation);
            
            // ç¾åœ¨åœ°ãƒœã‚¿ãƒ³
            document.getElementById('current-location-btn').addEventListener('click', getCurrentLocation);
            
            // ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('debug-toggle-btn').addEventListener('click', function() {
                const panel = document.getElementById('debug-panel');
                panel.classList.toggle('show');
                debugLog('ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆ');
            });
            
            // Enterã‚­ãƒ¼ã§æ¤œç´¢
            document.getElementById('location-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchLocation();
                }
            });
            
            debugLog('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†');
        });
        
        // ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.gm_authFailure = function() {
            debugLog('Google Maps APIèªè¨¼ã‚¨ãƒ©ãƒ¼', 'error');
            updateStatus('Google Maps APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™', 'error');
        };
    </script>
    
    <!-- Google Maps API ã‚’èª­ã¿è¾¼ã¿ -->
    <!-- æ³¨æ„: YOUR_API_KEY ã‚’å®Ÿéš›ã®APIã‚­ãƒ¼ã«ç½®ãæ›ãˆã¦ãã ã•ã„ -->
    <script async defer 
        src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap&libraries=places&language=ja">
    </script>
</body>
</html>